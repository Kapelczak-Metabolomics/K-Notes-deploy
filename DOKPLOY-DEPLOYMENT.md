# Deploying Kapelczak Notes with Dokploy

This guide provides step-by-step instructions for deploying Kapelczak Notes using the Dokploy GUI web interface. Dokploy simplifies container deployment with a user-friendly interface, allowing you to easily manage your application and resources.

## Table of Contents

1. [Prerequisites](#prerequisites)
2. [Deployment Files](#deployment-files)
3. [Step-by-Step Deployment Process](#step-by-step-deployment-process)
4. [Environment Configuration](#environment-configuration)
5. [Post-Deployment Steps](#post-deployment-steps)
6. [Monitoring and Health Checks](#monitoring-and-health-checks)
7. [Troubleshooting](#troubleshooting)
8. [Updating Your Deployment](#updating-your-deployment)

## Prerequisites

- Access to a Dokploy instance
- Your Kapelczak Notes codebase with the following files:
  - `dokploy.yaml`
  - `Dockerfile`
  - `.env.production` (for reference)

## Deployment Files

Kapelczak Notes provides two key files for Dokploy deployment:

1. **dokploy.yaml**: Configuration for your application, services, volumes, and resources
2. **Dockerfile**: Optimized multi-stage build for the application

## Step-by-Step Deployment Process

### 1. Log into Dokploy Dashboard

- Open your web browser and navigate to your Dokploy instance URL
- Log in with your credentials

### 2. Create a New Application

1. Click the "Create Application" or "+" button on the dashboard
2. Choose "Import from Git" or "Upload Files" based on your preference

#### Option A: Import from Git Repository

1. Enter your Git repository URL
2. Provide necessary authentication (SSH key or access token if private)
3. Select the branch containing your code (usually `main` or `master`)
4. Click "Continue"

#### Option B: Upload Files Directly

1. Choose "Upload Files" option
2. Upload your codebase as a zip file or select individual files
3. Ensure `dokploy.yaml` and `Dockerfile` are included
4. Click "Continue"

### 3. Configure Application Settings

1. **Application Name**: Verify the name is set to "kapelczak-notes" (from dokploy.yaml)
2. **Description**: Confirm description as "Kapelczak Notes - Laboratory Documentation Platform"
3. **Resource Allocation**:
   - CPU: 1 (default from dokploy.yaml)
   - Memory: 2Gi (default from dokploy.yaml)
   - Storage:
     - postgres_data: 5Gi
     - uploads: 10Gi
4. Click "Next"

### 4. Configure Environment Variables

1. In the "Environment Variables" section, add the following:

   | Variable | Description | Example Value |
   |----------|-------------|---------------|
   | `SESSION_SECRET` | Secret for session encryption | A random string (e.g., `da4c46a3b8d1f9e7`) |
   | `DATABASE_URL` | Will be auto-generated by Dokploy | Leave empty |
   | `POSTGRES_USER` | PostgreSQL username | `kapelczak_user` |
   | `POSTGRES_PASSWORD` | PostgreSQL password | A secure password |
   | `POSTGRES_DB` | PostgreSQL database name | `kapelczak_notes` |
   | `SMTP_HOST` | SMTP server hostname | `smtp.example.com` |
   | `SMTP_PORT` | SMTP server port | `587` |
   | `SMTP_USER` | SMTP username | `your_smtp_username` |
   | `SMTP_PASSWORD` | SMTP password | Your SMTP password |

2. Click "Next"

### 5. Network Configuration

1. **Port Configuration**:
   - Verify that port 5000 is mapped correctly (from dokploy.yaml)
   - Choose whether to expose the port publicly or internally

2. **Domain Configuration** (Optional):
   - If you want to use a custom domain, enable the option
   - Enter your domain name (e.g., `notes.yourdomain.com`)
   - Configure SSL settings (recommended)

3. Click "Next"

### 6. Review and Deploy

1. Review all configuration settings
2. Confirm that resources, environment variables, and network settings are correct
3. Click "Deploy" to start the deployment process

### 7. Monitor Deployment Progress

1. Dokploy will display a deployment progress page
2. You'll see logs for each step:
   - Building the Docker image
   - Creating PostgreSQL database
   - Setting up volumes
   - Running setup scripts
   - Starting services

## Environment Configuration

Dokploy will automatically:

1. Set up the PostgreSQL database
2. Configure networking between services
3. Create persistent volumes for data storage
4. Generate connection strings for the database

All environment variables defined in the dokploy.yaml file will be injected into the application.

## Post-Deployment Steps

### 1. Initial Login

After deployment completes:

1. Access your application URL (shown in the Dokploy dashboard)
2. Log in with the default credentials:
   - Username: `admin`
   - Password: `demo`
3. **IMPORTANT**: Change the default password immediately after first login!

### 2. Configure SMTP Settings

If you need email functionality:

1. Go to Settings → Email
2. Verify your SMTP configuration
3. Send a test email to confirm it's working

### 3. Configure S3 Storage (Optional)

For additional file storage options:

1. Go to Settings → Storage
2. Enter your S3-compatible storage credentials
3. Test the connection

## Monitoring and Health Checks

Dokploy provides several monitoring features:

1. **Health Checks**: The application has a health check endpoint at `/api/health`
2. **Resource Monitoring**: View CPU, memory, and disk usage
3. **Logs**: Access logs for troubleshooting

To view application metrics:

1. Go to your application in the Dokploy dashboard
2. Select "Monitoring" or "Metrics" tab
3. View health status and resource utilization

## Troubleshooting

If you encounter issues:

### Database Connection Problems

1. Check database logs in the Dokploy dashboard
2. Verify PostgreSQL service is running
3. Confirm environment variables are correctly set

### Application Startup Issues

1. Check application logs in the Dokploy dashboard
2. Verify the health check is passing
3. Confirm that setup scripts completed successfully

### Email Sending Problems

1. Test SMTP connection in the admin interface
2. Check SMTP credentials in environment variables
3. Verify SMTP server allows connections from your deployment

## Updating Your Deployment

To update your application:

1. Go to your application in the Dokploy dashboard
2. Select "Update" or "Redeploy"
3. Choose your update method:
   - Pull latest code from Git
   - Upload new files
   - Edit configuration
4. Confirm changes and deploy

Dokploy will perform a rolling update to minimize downtime.

---

For additional assistance, contact your Dokploy administrator or refer to the Dokploy documentation.